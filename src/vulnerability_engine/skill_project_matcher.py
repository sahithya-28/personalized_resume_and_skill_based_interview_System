from utils.text_cleaner import normalize

def detect_skill_project_mismatch(skills: list, project_lines: list) -> dict:
    projects_text = normalize("\n".join(project_lines))

    if len(skills) >= 8 and len(project_lines) <= 2:
        return {
            "flag": True,
            "details": "Many skills mentioned but very few project details available (skill depth risk)."
        }

    missing_skills = []
    for skill in skills:
        if normalize(skill) not in projects_text:
            missing_skills.append(skill)

    ratio = 0
    if skills:
        ratio = len(missing_skills) / len(skills)

    if ratio >= 0.7 and len(skills) >= 5:
        return {
            "flag": True,
            "details": f"Most skills are not reflected in projects. Missing in projects: {missing_skills[:8]}"
        }

    return {"flag": False, "details": "Skills appear reasonably supported by projects."}
