from utils.text_cleaner import normalize

ENGINEERING_DOMAINS = {
    "cse": ["computer science", "cse", "it", "information technology"],
    "ece": ["electronics", "ece", "communication"],
    "mech": ["mechanical", "mech"],
    "civil": ["civil"],
}

TARGET_DOMAINS = {
    "software": ["software", "developer", "backend", "frontend", "full stack"],
    "data": ["data science", "machine learning", "deep learning", "ai", "nlp", "analyst"]
}

def detect_domain_switch(education_lines: list, skills: list) -> dict:
    edu_text = normalize("\n".join(education_lines))
    skill_text = normalize(" ".join(skills))

    edu_domain = None
    for dom, keys in ENGINEERING_DOMAINS.items():
        if any(k in edu_text for k in keys):
            edu_domain = dom
            break

    target_domain = None
    for dom, keys in TARGET_DOMAINS.items():
        if any(k in skill_text for k in keys):
            target_domain = dom
            break

    if edu_domain and target_domain:
        if edu_domain in ["ece", "mech", "civil"] and target_domain in ["software", "data"]:
            return {
                "flag": True,
                "details": f"Possible domain switch detected: {edu_domain.upper()} â†’ {target_domain.upper()}"
            }

    return {"flag": False, "details": "No strong domain switch detected."}
